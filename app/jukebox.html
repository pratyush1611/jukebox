<!doctype html>
<meta name=viewport content="width=device-width, initial-scale=1">
<title>Wi-Fi Jukebox</title>
<style>
 body{font-family:system-ui,Arial;max-width:800px;margin:24px auto;padding:0 12px}
 #now{padding:10px;border:1px solid #ddd;border-radius:8px;margin-bottom:12px}
 li{display:flex;align-items:center;gap:8px;margin:6px 0}
 button{padding:6px 10px;border-radius:6px;border:1px solid #ccc;background:#f5f5f5;cursor:pointer}
 input[type=text]{width:70%;padding:8px}
 input[type=range]{width:100%;margin:8px 0}
 small{color:#666}
 #progress{display:flex;align-items:center;gap:8px;margin:8px 0}
</style>
<div id=now><i>Nothing playing</i></div>
<form id=f>
  <input id=q placeholder="YouTube link or search…" autofocus>
  <button type=submit>+ Add</button>
</form>
<ul id=list></ul>
<div style="margin-top:12px">
  <button onclick="post('/play')">Play</button>
  <button onclick="post('/pause')">Pause</button>
  <button onclick="post('/skip')">Skip</button>
</div>
<script>
async function j(url,method='GET',body=null){
  const o={method,headers:{'Content-Type':'application/json'}};
  if(body) o.body=JSON.stringify(body);
  const r=await fetch(url,o); return r.json();
}
async function refresh(){
  const s=await j('/queue'); const n=document.getElementById('now');
  if(s.now){
    const pos = s.now.position || 0; const dur = s.now.duration || 0;
    const fmt = t => `${Math.floor(t/60)}:${String(Math.floor(t%60)).padStart(2,'0')}`;
    n.innerHTML = `<b>Now:</b> ${s.now.title} <small>by ${s.now.uploader}</small>
      <div id=progress><span>${fmt(pos)}</span><input type=range id=seek min=0 max=${dur} value=${pos}><span>${fmt(dur)}</span></div>`;
    document.getElementById('seek').oninput = e => post('/seek', {pos: e.target.value});
  } else n.innerHTML = '<i>Nothing playing</i>';
  const ul=document.getElementById('list'); ul.innerHTML='';
  (s.queue||[]).forEach((it,i)=>{
    const li=document.createElement('li');
    li.innerHTML=`<span style="flex:1">${i+1}. ${it.title} <small>by ${it.uploader} — #${it.id}</small></span>`;
    ul.appendChild(li);
  });
}
async function post(u,body){ await j(u,'POST',body); refresh(); }
document.getElementById('f').addEventListener('submit', async (e)=>{
  e.preventDefault(); const v=document.getElementById('q').value.trim(); if(!v) return;
  await j('/add','POST',{q:v}); document.getElementById('q').value=''; refresh();
});
setInterval(refresh,2000); refresh();
</script>
